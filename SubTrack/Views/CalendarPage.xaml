<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Name="calendarPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:SubTrack.Controls"
             xmlns:viewModels="clr-namespace:SubTrack.ViewModels"
             x:Class="SubTrack.Views.CalendarPage">

    <ContentPage.BindingContext>
        <!-- Définir le BindingContext pour la page -->
        <viewModels:CalendarPageViewModel/>
    </ContentPage.BindingContext>

    <Grid Padding="12" RowDefinitions="Auto, Auto, *">
        <!-- Utilisation du contrôle CalendarComponent avec des liaisons de données -->
        <controls:CalendarComponent
            Grid.Row="0"
            CurrentYear="{Binding CurrentYear, Mode=TwoWay}"
            CurrentMonth="{Binding CurrentMonth, Mode=TwoWay}"
            BindingContext="{Binding CalendarViewModel}">
        </controls:CalendarComponent>

        <!-- Séparateur -->
        <BoxView Grid.Row="1" Style="{StaticResource SeparatorStyle}"/>

        <!-- Représente l'ensemble des dépenses qui tombent mensuellement pour l'utilisateur -->
        <CollectionView Grid.Row="2"
                        ItemsSource="{Binding Expenses, Mode=TwoWay}"
                        VerticalOptions="FillAndExpand">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems Mode="Reveal">
                                <SwipeItem Text="Supprimer"
                                   BackgroundColor="Red"
                                   IconImageSource="trash.png"
                                   Command="{Binding Source={x:Reference calendarPage}, Path=BindingContext.DeleteExpenseCommand}"
                                   CommandParameter="{Binding ExpenseId}" />
                            </SwipeItems>
                        </SwipeView.RightItems>
                        <controls:ExpenseItemComponent BindingContext="{Binding .}"/>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Bouton en bas à droite de la page -->
        <Button
            Grid.Row="0" Grid.RowSpan="3"
            Text="+" 
            VerticalOptions="End"
            HorizontalOptions="End"
            FontSize="Large"
            Margin="0,0,20,20"
            BackgroundColor="#2596be"
            TextColor="White"
            WidthRequest="60"
            HeightRequest="60"
            CornerRadius="10"
            Command="{Binding AddExpenseCommand}"/>
    </Grid>
</ContentPage>



